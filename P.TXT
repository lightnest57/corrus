#!/bin/bash
sudo apt update && sudo apt upgrade -y
export DEBIAN_FRONTEND=noninteractive
mkdir -p ~/.config/rclone
cd ~/
wget https://raw.githubusercontent.com/lightnest57/local_manifest/main/.rclone.conf
git config --global user.name "darknius09"
git config --global user.email "darkniuslightnest@gmail.com"
echo "https://darknius09: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@github.com" > ~/.git-credentials
git config --global credential.helper store --file=~/.git-credentials
mkdir -p ~/ccache
cd ~/
wget -O ccache.tar.gz https://pikabot.me/0:/evox14ccache.tar.gz
time tar xf ccache.tar.gz
cd ~/
curl -s https://api.telegram.org/bot5619457656:AAHUSkFen7uFESXvzvVyMgESofhQbFiAWFE/sendMessage -d chat_id=-1001387923273 -d text="Start sync Source"
mkdir -p ~/rom
cd ~/rom
repo init -q --no-repo-verify --depth=1 -u https://github.com/Evolution-X/manifest -b udc -g default,-mips,-darwin,-notdefault
git clone --depth 1 https://github.com/Night-Raids-Reborn/local_manifest -b 14-n .repo/local_manifests
repo sync -c --no-clone-bundle --no-tags --optimized-fetch --prune --force-sync -j8
curl -s https://api.telegram.org/bot5619457656:AAHUSkFen7uFESXvzvVyMgESofhQbFiAWFE/sendMessage -d chat_id=-1001387923273 -d text="Sync Completed!"
export BUILD_USERNAME="Free_Palestine"
export BUILD_HOSTNAME="Free_Palestine"
export KBUILD_BUILD_USER="FreePalestine"
export KBUILD_BUILD_HOST="Nanomachine"
sudo ln -sf /usr/share/zoneinfo/Asia/Jakarta /etc/localtime
curl -s https://api.telegram.org/bot5619457656:AAHUSkFen7uFESXvzvVyMgESofhQbFiAWFE/sendMessage -d chat_id=-1001387923273 -d text="Build Started!"

cd ~/rom

. build/envsetup.sh
export TZ=Asia/Jakarta
export CCACHE_DIR=~/ccache
export CCACHE_EXEC=$(which ccache)
export USE_CCACHE=1
ccache -M 100G -F 0
ccache -o compression=true
ccache -z

lunch evolution_citrus-userdebug
mka evolution -j$(nproc)
curl -s https://api.telegram.org/bot5619457656:AAHUSkFen7uFESXvzvVyMgESofhQbFiAWFE/sendMessage -d chat_id=-1001387923273 -d text="Uploading Build $(cd ~/rom/out/target/product/citrus/ && ls evolution_citrus.zip)"
rclone copy ~/rom/out/target/product/citrus/evolution_citrus*.zip fk09:citrus -P
curl -s https://api.telegram.org/bot5619457656:AAHUSkFen7uFESXvzvVyMgESofhQbFiAWFE/sendMessage -d chat_id=-1001387923273 -d text="Build $(cd ~/rom/out/target/product/citrus/ && ls evolution_citrus*.zip) Uploaded Successfully!"
